#!/usr/bin/env python3
# coding: utf-8

import os
import numpy as np
import pytest

import af2_analysis
from .data_files import TEST_FILE_PATH

def test_cf_1_5_5_relax():

    data_path = os.path.join(TEST_FILE_PATH, 'beta_amyloid_dimer_cf_1.5.5')

    my_data = af2_analysis.Data(data_path)
    my_data.compute_pdockq()

    expected_pdockq = [0.03321742226653011, 0.020508079436707637, 0.02999545914696395, 0.029710716856929675, 0.12094157800439273, 0.028491530264313406, 0.0224606454311364, 0.048450745709218535, 0.019803669585024202, 0.0714878573754393, 0.033185877247547915, 0.023790222293708738, 0.027627719015829846, 0.05581549854097387, 0.14434733086935014, 0.02418454507820076, 0.021121254996122336, 0.025214567025696244, 0.04188541819957342, 0.13843543878662867, 0.029520485401755583, 0.021234474490712474, 0.028511461285936398, 0.052368203799065996, 0.12850067565985152, 0.029085153510331765, 0.020420203929632855, 0.02843332696872418, 0.02069462281140889, 0.08226716913261924, 0.023121145924799476, 0.02025395150654621, 0.028243220444425197, 0.05085036880984188, 0.13349980342207732, 0.02940299606705711, 0.020625297863990692, 0.025422893115604955, 0.036225154580672395, 0.13153722442346188]

    assert 2.2 == pytest.approx(2.3, 0.1)

    precision = 0.00001
    assert np.all([my_data.df.iloc[i]['pdockq'] == pytest.approx(expected_pdockq[i], precision) for i in range(len(my_data.df))])

    my_data.compute_pdockq2()

    expected_pdockq2 = [0.011992377761781624, 0.010623502825853916, 0.014287393107491362, 0.016360241087882515, 0.16843769196880837, 0.01660719764114339, 0.011501255484394957, 0.023876264454590766, 0.00894615176611865, 0.029643125652562066, 0.011743095600756022, 0.012556004410170156, 0.013411431021003551, 0.05057689744287013, 0.19585418389375442, 0.013980233431006676, 0.011155976989410683, 0.012924243139102683, 0.026617522270273215, 0.19001258262704077, 0.012181478391521876, 0.01121967039672862, 0.01373192964732851, 0.05063928868857694, 0.18354464370380283, 0.012047567412135498, 0.011353809353881642, 0.0135206158846175, 0.01024920348833033, 0.022308014289400144, 0.01375701095768727, 0.010598887368128494, 0.014120593361520547, 0.044224937088857184, 0.18531678302092217, 0.012474998730780455, 0.010781007240176489, 0.012576527553154492, 0.02291222277566717, 0.1989599612452114]
    assert np.all([my_data.df.iloc[i]['pdockq2_B'] == pytest.approx(expected_pdockq2[i], precision) for i in range(len(my_data.df))])

    my_data.compute_LIS_matrix()
            